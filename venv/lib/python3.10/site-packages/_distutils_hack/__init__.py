<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
import sys
import os
import re
import importlib
import warnings


is_pypy = '__pypy__' in sys.builtin_module_names


warnings.filterwarnings('ignore',
                        r'.+ distutils\b.+ deprecated',
                        DeprecationWarning)
=======
# don't import any costly modules
import sys
import os
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py


def warn_distutils_present():
    if 'distutils' not in sys.modules:
        return
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
    if is_pypy and sys.version_info < (3, 7):
        # PyPy for 3.6 unconditionally imports distutils, so bypass the warning
        # https://foss.heptapod.net/pypy/pypy/-/blob/be829135bc0d758997b3566062999ee8b23872b4/lib-python/3/site.py#L250
        return
=======
    import warnings

>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py
    warnings.warn(
        "Distutils was imported before Setuptools, but importing Setuptools "
        "also replaces the `distutils` module in `sys.modules`. This may lead "
        "to undesirable behaviors or errors. To avoid these issues, avoid "
        "using distutils directly, ensure that setuptools is installed in the "
        "traditional way (e.g. not an editable install), and/or make sure "
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
        "that setuptools is always imported before distutils.")
=======
        "that setuptools is always imported before distutils."
    )
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py


def clear_distutils():
    if 'distutils' not in sys.modules:
        return
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
    warnings.warn("Setuptools is replacing distutils.")
    mods = [name for name in sys.modules if re.match(r'distutils\b', name)]
=======
    import warnings

    warnings.warn("Setuptools is replacing distutils.")
    mods = [
        name
        for name in sys.modules
        if name == "distutils" or name.startswith("distutils.")
    ]
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py
    for name in mods:
        del sys.modules[name]


def enabled():
    """
    Allow selection of distutils by environment variable.
    """
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
    which = os.environ.get('SETUPTOOLS_USE_DISTUTILS', 'stdlib')
=======
    which = os.environ.get('SETUPTOOLS_USE_DISTUTILS', 'local')
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py
    return which == 'local'


def ensure_local_distutils():
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
=======
    import importlib

>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py
    clear_distutils()

    # With the DistutilsMetaFinder in place,
    # perform an import to cause distutils to be
    # loaded from setuptools._distutils. Ref #2906.
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
    add_shim()
    importlib.import_module('distutils')
    remove_shim()
=======
    with shim():
        importlib.import_module('distutils')
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py

    # check that submodules load as expected
    core = importlib.import_module('distutils.core')
    assert '_distutils' in core.__file__, core.__file__
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
=======
    assert 'setuptools._distutils.log' not in sys.modules
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py


def do_override():
    """
    Ensure that the local copy of distutils is preferred over stdlib.

    See https://github.com/pypa/setuptools/issues/417#issuecomment-392298401
    for more motivation.
    """
    if enabled():
        warn_distutils_present()
        ensure_local_distutils()


<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
class DistutilsMetaFinder:
    def find_spec(self, fullname, path, target=None):
        if path is not None:
            return
=======
class _TrivialRe:
    def __init__(self, *patterns):
        self._patterns = patterns

    def match(self, string):
        return all(pat in string for pat in self._patterns)


class DistutilsMetaFinder:
    def find_spec(self, fullname, path, target=None):
        # optimization: only consider top level modules and those
        # found in the CPython test suite.
        if path is not None and not fullname.startswith('test.'):
            return None
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py

        method_name = 'spec_for_{fullname}'.format(**locals())
        method = getattr(self, method_name, lambda: None)
        return method()

    def spec_for_distutils(self):
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
        import importlib.abc
        import importlib.util

        class DistutilsLoader(importlib.abc.Loader):

            def create_module(self, spec):
                return importlib.import_module('setuptools._distutils')
=======
        if self.is_cpython():
            return None

        import importlib
        import importlib.abc
        import importlib.util

        try:
            mod = importlib.import_module('setuptools._distutils')
        except Exception:
            # There are a couple of cases where setuptools._distutils
            # may not be present:
            # - An older Setuptools without a local distutils is
            #   taking precedence. Ref #2957.
            # - Path manipulation during sitecustomize removes
            #   setuptools from the path but only after the hook
            #   has been loaded. Ref #2980.
            # In either case, fall back to stdlib behavior.
            return None

        class DistutilsLoader(importlib.abc.Loader):
            def create_module(self, spec):
                mod.__name__ = 'distutils'
                return mod
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py

            def exec_module(self, module):
                pass

<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
        return importlib.util.spec_from_loader('distutils', DistutilsLoader())
=======
        return importlib.util.spec_from_loader(
            'distutils', DistutilsLoader(), origin=mod.__file__
        )

    @staticmethod
    def is_cpython():
        """
        Suppress supplying distutils for CPython (build and tests).
        Ref #2965 and #3007.
        """
        return os.path.isfile('pybuilddir.txt')
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py

    def spec_for_pip(self):
        """
        Ensure stdlib distutils when running under pip.
        See pypa/pip#8761 for rationale.
        """
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
        if self.pip_imported_during_build():
=======
        if sys.version_info >= (3, 12) or self.pip_imported_during_build():
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py
            return
        clear_distutils()
        self.spec_for_distutils = lambda: None

<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
    @staticmethod
    def pip_imported_during_build():
=======
    @classmethod
    def pip_imported_during_build(cls):
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py
        """
        Detect if pip is being imported in a build script. Ref #2355.
        """
        import traceback
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
        return any(
            frame.f_globals['__file__'].endswith('setup.py')
            for frame, line in traceback.walk_stack(None)
        )

=======

        return any(
            cls.frame_file_is_setup(frame) for frame, line in traceback.walk_stack(None)
        )

    @staticmethod
    def frame_file_is_setup(frame):
        """
        Return True if the indicated frame suggests a setup.py file.
        """
        # some frames may not have __file__ (#2940)
        return frame.f_globals.get('__file__', '').endswith('setup.py')

    def spec_for_sensitive_tests(self):
        """
        Ensure stdlib distutils when running select tests under CPython.

        python/cpython#91169
        """
        clear_distutils()
        self.spec_for_distutils = lambda: None

    sensitive_tests = (
        [
            'test.test_distutils',
            'test.test_peg_generator',
            'test.test_importlib',
        ]
        if sys.version_info < (3, 10)
        else [
            'test.test_distutils',
        ]
    )


for name in DistutilsMetaFinder.sensitive_tests:
    setattr(
        DistutilsMetaFinder,
        f'spec_for_{name}',
        DistutilsMetaFinder.spec_for_sensitive_tests,
    )

>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py

DISTUTILS_FINDER = DistutilsMetaFinder()


def add_shim():
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
    sys.meta_path.insert(0, DISTUTILS_FINDER)


def remove_shim():
=======
    DISTUTILS_FINDER in sys.meta_path or insert_shim()


class shim:
    def __enter__(self):
        insert_shim()

    def __exit__(self, exc, value, tb):
        _remove_shim()


def insert_shim():
    sys.meta_path.insert(0, DISTUTILS_FINDER)


def _remove_shim():
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py
    try:
        sys.meta_path.remove(DISTUTILS_FINDER)
    except ValueError:
        pass
<<<<<<< HEAD:venv/lib/python3.10/site-packages/_distutils_hack/__init__.py
=======


if sys.version_info < (3, 12):
    # DistutilsMetaFinder can only be disabled in Python < 3.12 (PEP 632)
    remove_shim = _remove_shim
>>>>>>> 63c587b5f623b9cf60f81e2f967798a80ca5fec9:venv/lib/python3.12/site-packages/_distutils_hack/__init__.py
